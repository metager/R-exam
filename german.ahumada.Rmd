---
title: "german.ahumada.Rmd"
author: "German Dario Ahumada"
date: "18/05/2020"
output:
  html_document: default
  pdf_document: default
---


## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

# Working directory
```{r installing packages, echo=TRUE, results = 'hide'}
#this function checks if the r package is there, if not it installs it
if (!require("pacman")) {install.packages("pacman")}
#then p_load fucntion in pacman is used to iteratively load a bunch of packages
#if not present, they will be installed first
pacman::p_load(DT, ggplot2, ggfortify, pegas, ape, corrplot, devtools, RCurl, utils, mclust)
#install a package from source on GitHub
devtools::install_github("xiaolei-lab/rMVP")
install.packages("car")
install.packages("corrgram")
install.packages("imputeTS")
```
```{r loading packages}
library(imputeTS)
library(pacman)
library(dplyr)
library(plyr)
library(data.table)
library(ggpubr)
library(grid)
library(corrgram)
library(car)
```
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "C:/Users/Dario/Documents/PhD Agrobiodiversity/Courses/RforABD/Exam")

wd<-"C:/Users/Dario/Documents/PhD Agrobiodiversity/Courses/RforABD/Exam/"
setwd(wd)
```

``` {r directories}
#Create directory for results if not already there
if(dir.exists("./results")==F){
  dir.create("./results")
}
if(dir.exists("./docs")==F){
  dir.create("./docs")
}
if(dir.exists("./data")==F){
  dir.create("./data")
}
if(dir.exists("./scripts")==F){
  dir.create("./scripts")
}

```
# Importing Data
``` {r data_1}
data<-read.table("dataset.1.2019_2020.txt", header=T)
data
```
```{r columns}
colnames(data)
```
``` {r round numeric data}
data<-data %>% mutate_if(is.numeric, round, digits=2)
data
```


#1. How to deal with missing values? 


Listwise deletion (complete-case analysis) removes all data for an observation that has one or more missing values. 

Particularly if the missing data is limited to a small number of observations, you may just opt to eliminate those cases from the analysis.
```{r dealing with NA values}
nas<-is.na(data)
nas
```
```{r  revalue missing data}
data$REP <- revalue(data$REP, c( "missing" = NA))
data$REP <- revalue(data$REP, c( "?" = NA))
data$LOCATION <-revalue(data$LOCATION, c("Hagreselam" = "hagreselam"))
View(data)
```

```{r Summary of data}
summary(data)
```

``` {r new data set without NA values}
newdata <- na.omit(data)
newdata
```
``` {r new data set view}
View(newdata)
```


# 2. Create new columns reporting the average overall scores given my male farmers and female farmers


```{r average of farmers}
newdata$females = rowMeans(newdata[,c(9, 10, 11, 12)])
newdata$males = rowMeans(newdata[,c (13, 14, 15, 16, 17)])
colnames(newdata)
```


# 3. Remove from the dataset the individual OVERALL measures


```{r Removing overall columns}
newdata <- newdata[,-(9:17)] 
colnames(newdata)
```

``` {r print a new data table better organised}
newdata<-data.table(newdata)
newdata
```
# These data comprisemetric tratis and the means of farmers appreciation of wheat (1=bad; 5=good). Let's sort them apart
``` {r farmers means and metrics (replicates and plots are not being considered as important)}
metrics <-(newdata[,c("BM","DM", "GY", "TGW","YEAR")])
farmdata<-(newdata[,c("males", "females")])
metrics
```

``` {r plotting farmers appreciations by gender with statistical analysis}
sfarm<-stack(farmdata)
bo <- element_text(face = "bold")
ggplot(data=sfarm, aes(x=ind, y=values, fill=ind))+geom_boxplot() + 
  ylim(c(0,5)) +
  geom_jitter(shape=16, position=position_jitter(0.2)) + 
  scale_fill_manual(values=c("light blue", "light pink")) +
  theme(axis.title.y = bo, axis.title.x = bo) + 
  stat_compare_means(show.legend = T, label.y.npc = "bottom") + 
  ggtitle("Participatory Evaluation by Gender") +
  theme(plot.title=element_text( family= '',hjust=0.5, vjust=0.5, face='bold', colour='dark blue', size =18))
```

# 4. Produce a plot for both farmer scores and GY (plot type of your choice)

``` {r #Correlation plots }
cr<-cor(farmdata, metrics, use="pairwise.complete.obs")
cr
corrplot(cr, method="pie", type = "full", is.corr = T, order = "original",
         title = "Correlation between appreciation of famers by gender and Grain Yield")
                                                                                                        
```
```{r}

```
# TO CORRECT

``` {r distributions}
df<- data.frame(metrics, farmdata)
df
qqPlot(~GY, data=df, id=list(10))

```
````{r}
corrplot(dfcor, method="pie", type = "full", is.corr = T, order = "original",
         title = "Correlation between appreciation of famers by gender and wheat performance")
```


